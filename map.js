var map=L.map('map').setView([11.759852,107.418673],8);const satellite=L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{attribution:'Imagery &copy; <a href="https://www.esri.com/">Esri</a>',maxZoom:18,});const street=L.tileLayer('https://api.maptiler.com/maps/topo-v2/256/{z}/{x}/{y}@2x.png?key=fbV6AyWrR3xmdPjUVtzn',{attribution:'Map data &copy; <a href="https://www.maptiler.com/">MapTiler</a> contributors',maxZoom:28,});const basemaps={"Satellite Imagery":satellite,"Street":street};street.addTo(map);const customControl=L.control({position:'bottomleft'});customControl.onAdd=function(map){const container=L.DomUtil.create('div','basemap-control');const img=L.DomUtil.create('img','basemap-image',container);img.src='https://i.ibb.co/fHNQYvD/imagery.png';img.alt='Basemap Imagery';const label=L.DomUtil.create('div','basemap-label',container);label.textContent='Imagery';img.onclick=function(){if(map.hasLayer(street)){map.removeLayer(street);satellite.addTo(map);img.src='https://i.ibb.co/j4TfkcV/street.png';label.textContent='Street';}else{map.removeLayer(satellite);street.addTo(map);img.src='https://i.ibb.co/fHNQYvD/imagery.png';label.textContent='Imagery';}};return container;};customControl.addTo(map);var customIcon=L.icon({iconUrl:'https://i.ibb.co/gWyRjHP/icons8-pin-96-xxhdpi.png',iconSize:[30,30],iconAnchor:[19,38],popupAnchor:[0,-38]});var images=['https://www.spiralhorncoffee.com/wp-content/uploads/2021/01/photodune-gsEC867x-lush-green-coffee-landscape-xxl-scaled.jpg','https://th.bing.com/th/id/OIP.F91NFZfL7nA--b2vzNLXTwHaE8?rs=1&pid=ImgDetMain','https://www.giz.de/static/en/media/gizIMAGE-kaffee-costa-rica.jpg','https://www.perfectdailygrind.com/wp-content/uploads/2018/04/coffee-farm-3.jpg'];fetch('https://api-ma.enfarm.com/api/v1/ma/get-install-locations',{headers:{'accept':'application/json'}}).then(response=>response.json()).then(data=>{var markers=L.markerClusterGroup();var totalDevicesCount=data.content.length;data.content.forEach(location=>{var randomImage=images[Math.floor(Math.random()*images.length)];var popupContent=`<p><img src="${randomImage}"alt="Farm Image"style="width:100%; height:auto; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); border-radius: 5px;"><p><b>Farm name:</b>${location.farmname}<br><b>Region name:</b>${location.region_name}`;var marker=L.marker([location.lat,location.long],{icon:customIcon}).bindPopup(popupContent);markers.addLayer(marker);});map.addLayer(markers);document.getElementById('totalDevicesCount').innerText=totalDevicesCount;}).catch(error=>console.error('Error fetching data:',error));map.zoomControl.remove();