<!DOCTYPE html><html> <head><meta charset=utf-8><title>enfarm 3D viewer</title><meta name=viewport content="initial-scale=1,maximum-scale=1,user-scalable=no"><!-- Favicon --><link rel=icon href=https://i.ibb.co/tQDxF41/enfarm-favicon.png type=image/png><!--Mapbox--><link href=https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css rel=stylesheet><script src=https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js></script><!-- Google Fonts --><link href="https://fonts.googleapis.com/css2?family=Be+Vietnam:wght@400;500;600;700&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel=stylesheet><!--Axios--><script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js></script><!--ChartJS--><script src=https://cdn.jsdelivr.net/npm/chart.js></script><!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.js" type="module"></script>--><!--Font Awesome--><script src=https://kit.fontawesome.com/0eb73cfc5c.js crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css><!--Flat Icon UI--><link rel=stylesheet href=https://cdn-uicons.flaticon.com/uicons-thin-straight/css/uicons-thin-straight.css><!-- CSS --><link rel=stylesheet href=./mapbox3Dterrain.css><link rel=stylesheet href=./farmlist.css><style>
        /*North Arrow*/
        .north-arrow {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

        .north-arrow-icon {
            font-size: 48px;
            text-shadow: 0 0 5px rgba(109, 109, 109, 0.9);
            color: rgb(56, 56, 56);
        }

        .north-text {
            position: absolute;
            top: 40px;
            left: 15px;
            font-size: 20px;
            font-weight: bolder;
            color: rgb(255, 0, 0);
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.9);
        }
    </style></head> <body> <div id=map> <canvas id=rainCanvas></canvas> <div id=inset-map></div> <div id=popup-farmlist class=popup-farmlist> <button class=close-farmlist-btn onclick=hideFarmList() style="color: #555;">&times;</button> <div class=farmlist-header> <div style="display: flex; align-items: center;"> <span class=material-symbols-outlined style="margin-right: 4px;">psychiatry</span> <h2 style="margin: 0;">Managed Farms</h2> </div> <div class=sort-dropdown> <button id=sort-button class=sortButton> Sort By &nbsp; <i class="fi fi-ts-angle-small-down"></i> </button> <div class=dropdown-content> <a href=# onclick="sortFarmList('status')">Status</a> <a href=# onclick="sortFarmList('size')">Farm size</a> <a href=# onclick="sortFarmList('lastUpdated')">Last updated</a> <a href=# onclick="sortFarmList('name')">Name</a> <a href=# onclick="sortFarmList('produce')">Produce</a> </div> </div> </div> <div id=farm-list-container class=farm-list-container> <div class=fetching-data>Fetching data...</div> <div class=sorting-message></div> </div> </div> </div> <!--Show Managed Farm List--> <button class=farmlist-button onclick=toggleFarmList()> <span class=material-symbols-outlined>list</span> <span class=tooltip-right>See farm lists</span> </button> <a href=https://enfarm.com/ target=_blank> <img src=https://i.ibb.co/LdXsHXJ/enfarm-logo.png class=company-logo3D alt="enfarm Logo"> </a> <div class=search-container> <input type=text class=search-input placeholder=Search... oninput=searchFeatures(this.value) id=searchInput> <button class=clear-button onclick=clearSearch() style="display: none;"> <span class=material-icons-outlined>close</span> </button> </div> <button class=switch2Dmap-button onclick=switch2Dmap()> <span class=material-symbols-outlined>2d</span> <span class=tooltip-right>Switch to 2D Map View</span> </button> <button class=mapbox3Dterrain-button onclick=switchBasemap()> <span class=material-icons-outlined>landscape</span> <span class=tooltip-right>Switch Basemap</span> </button> <!--Info button and info box--> <button class=info-button onclick=toggleInfo()> <span class=material-icons-outlined>info</span> <span class=tooltip-left>Show Info</span> </button> <div class=info-box> <div class=info-content> <div class=info-image></div> <p>About</p> <div class=info-logo> <img src=https://enfarm.com/fd57352e4cea98b4c1fb.jpg alt="enFarm Logo" style="width: 80px; height: auto;"> </div> <p> Map application to track and visualize deployed enfarm devices</p> <button class=dismiss-button onclick=toggleInfo()>Dismiss</button> </div> </div> <!--Instructions button and window ---> <button class=instructions-button id=instructionsButton> <span class=material-icons-outlined>mouse</span> <span class=tooltip-left>Show Instructions</span> </button> <div id=instructions-window class=instructions-window> <button id=closeInstructions class=close-button> <span class=material-icons-outlined>close</span> </button> <!--3D View Instructions--> <div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 10px;"> <span class=material-icons-outlined style="margin-right: 5px;">mouse</span> <h3 style="font-weight: bold; margin: 0;">Navigating the 3D Map</h3> </div> <div style="display: flex; align-items: center;"> <div> <img src=https://i.ibb.co/dGjF58h/icons8-left-click-96.png alt="Left Mouse Click Icon" style="vertical-align: middle; width: 50px; height: 50px;"> </div> <div style="margin-left: 10px;"> <div style="font-weight: bold;">Show farm information</div> <div>Left mouse button click on a farm point</div> </div> </div> <div style="display: flex; align-items: center; margin-top: 10px;"> <div> <img src=https://i.ibb.co/dGjF58h/icons8-left-click-96.png alt="Left Mouse Click Icon" style="vertical-align: middle; width: 50px; height: 50px;"> </div> <div style="margin-left: 10px;"> <div style="font-weight: bold;">Pan the map</div> <div>Left mouse button click + drag</div> </div> </div> <div style="display: flex; align-items: center; margin-top: 10px;"> <div style="margin-left: 2px;"> <img src=https://i.ibb.co/9GqDfjw/icons8-mouse-scrolling-96.png alt="Mouse Scrolling Icon" style="vertical-align: middle; width: 50px; height: 50px;"> </div> <div style="margin-left: 10px;"> <div style="font-weight: bold;">Zoom the map view</div> <div>Use the mouse scroll wheel</div> </div> </div> <div style="display: flex; align-items: center; margin-top: 10px;"> <div style="margin-left: 6px; margin-right: 10px;"> <img src=https://i.ibb.co/YR3vKZt/icons8-right-click-96.png alt="Right Click Icon" style="vertical-align: middle; width: 50px; height: 50px;"> </div> <div> <div style="font-weight: bold;">Rotate the map</div> <div>Right mouse button click + drag</div> </div> </div> <br> </div> <!--Full screen button--> <button class=fullscreen-button onclick=fullscreen()> <span class=material-symbols-outlined>fullscreen</span> <span class=tooltip-right>Toggle fullscreen</span> </button> <!--Simulation Panel--> <button class=simulationToggle-button onclick=toggleSimulationPanel()> <span class=material-symbols-outlined>token</span> <span class=tooltip-right>Simulation</span> </button> <div class=simulation-buttons-container> <button class=animateRotate-button onclick=toggleRotation(this)> <span id=icon class=material-icons-outlined>play_circle</span> </button> <button class=weatherToggle-button onclick=toggleRainEffect()> <span class=material-symbols-outlined>rainy</span> </button> <button class=nightToggle-button onclick=toggleNightEffect()> <span class=material-symbols-outlined>nights_stay</span> </button> <button class=sunsetToggle-button onclick=toggleSunsetEffect()> <span class=material-symbols-outlined>wb_twilight</span> </button> <div class=simulation-panel> <span class="material-symbols-outlined icon">token</span> <h3 class=simulate-text>Simulate</h3> <div class=bottom-animatetext> <span>animate</span> </div> <div class=bottom-raintext> <span>rain</span> </div> <div class=bottom-nighttext> <span>night</span> </div> <div class=bottom-sunsettext> <span>sunset</span> </div> </div> </div> <!-- Statistics Dashboard 
    <button class="stats-button" onclick="toggleSlideMenuStats()">
        <span class="material-icons-outlined">donut_large</span>
    </button>
    <div id="slideMenuStats" class="slideMenuStats">
        <div class="slideMenuStats-content">
            <span class="material-icons-outlined slideMenuStats-close" onclick="toggleSlideMenuStats()">close</span>
            <h2 class="dashboard-title">Dashboard</h2>
            <div class="device-count" id="totalDevicesCount"></div>
            <div class="section-title">Devices deployed</div>
            <div class="divider"></div>
        </div>
    </div>--> <!-- Statistics Dashboard --> <button class=stats-button onclick=toggleSlideMenuStats()> <span class=material-icons-outlined>donut_large</span> <span class=tooltip-left>Show Dashboard</span> </button> <div id=slideMenuStats class=slideMenuStats> <div class=slideMenuStats-content> <span class="material-icons-outlined slideMenuStats-close" onclick=toggleSlideMenuStats()>close</span> <h2 class=dashboard-title>Dashboard</h2> <div style="display: flex; align-items: center; justify-content: center; gap: 20px; width: 100%;"> <!-- First Section --> <div style="display: flex; align-items: center; flex-direction: column;"> <div style="display: flex; align-items: center;"> <img src=https://i.ibb.co/0QhPSvr/icons8-land-plot-64.png alt="Farm Icon" style="width: 50px; height: 50px;"> <div class=farm-count id=totalfarmCount style="margin-top: -10px; margin-left: 10px;"></div> </div> <div class=section-title style="text-align: center; margin-top: -10px;">farms</div> </div> <!-- Second Section --> <div style="display: flex; align-items: center; flex-direction: column;"> <div style="display: flex; align-items: center;"> <img src=https://i.ibb.co/qkqGjtM/icons8-rhomboid-shape-100.png alt="Farm Icon" style="width: 40px; height: 40px;"> <div class=totalfarmarea-sum id=totalFarmAreaSum style="margin-top: -10px; margin-left: 10px;"></div> <div class=section-title style="margin-top: 10px; margin-left: 5px;">ha.</div> </div> <div class=section-title style="text-align: center; margin-top: -10px;">Land Area (Total)</div> </div> </div> <div class=divider></div> <!-- Divider line --> <div style="display: flex; align-items: center; flex-direction: column;"> <div style="display: flex; align-items: center;"> <img src=https://i.ibb.co/1dggvZL/icons8-rfid-sensor-96.png alt="RFID Sensor Icon" style="width: 50px; height: 50px;"> <div class=device-count id=totalDevicesCount style="margin-top: -10px; margin-left: 10px;"> </div> </div> <div class=section-title style="text-align: center; margin-top: -10px;">enfarm devices deployed</div> </div> <div class=divider></div> <!-- Divider line --> <!--Counter Farms Needing Attention--> <br> <div style="display: flex; align-items: center;"> <img src=https://i.ibb.co/Q9mfK1v/icons8-alert-96.png alt="Farm Icon" style="width: 60px; height: 60px; margin-right: 8px; margin-top: -30px; color: #545454;"> <div class=needattention-sum id=needAttentionSum style="padding-bottom: 5px;"></div> <div class=section-title>&nbsp;&nbsp;/</div> <div class=section-title id=totalDevicesCountFraction></div> <div class=section-title>&nbsp;&nbsp;farm(s)</div> </div> <div class=section-title>needs attention</div> <div class=divider></div> <!-- Divider line --> <!--Counter Total Productivity--> <br> <div class=section-title style="text-align: center;">Productivity (Total)</div> <br> <br> <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"> <!-- Left section --> <div style="display: flex; align-items: center;"> <span class=material-symbols-outlined style="font-size: 40px; color: #545454; margin-right: 0px; margin-top: -30px;"> weight </span> <div class=currentproductivity-sum id=currentProductivitySum style="padding-bottom: -10px;"> </div> <div class=section-title>&nbsp;&nbsp;t</div> </div> <!-- Add a 50px gap --> <div style="width: 20px;"></div> <!-- Right section --> <div style="display: flex; align-items: center;"> <span class=material-icons-outlined style="font-size: 20px; color: #545454; margin-right: 0px; margin-top: -30px;"> north_east </span> <span class=material-symbols-outlined style="font-size: 40px; color: #545454; margin-left: -5px; margin-top: -30px;"> weight </span> <div class=expectedproductivity-sum id=expectedProductivitySum style="padding-bottom: 5px;"> </div> <div class=section-title>&nbsp;&nbsp;t</div> </div> </div> <div style="display: flex; justify-content: space-between;"> <!-- Left section title --> <div class=section-title style="text-align: left;">Current Prod.</div> <!-- Add a 50px gap --> <div style="width: 50px;"></div> <!-- Right section title --> <div class=section-title style="text-align: left;">Expected Prod.</div> </div> <div class=divider></div> <!-- Divider line --> <br> <div class=farm-grid> <div class=farm-pair> <div class="farm-icon coffeefarms-icon"></div> <div class=coffeefarms-count id=totalcoffeefarmsCount></div> <div class=section-title>Coffee cultivation</div> </div> <div class=farm-pair> <div class="farm-icon durianfarms-icon"></div> <div class=durianfarms-count id=totaldurianfarmsCount></div> <div class=section-title>Durian cultivation</div> </div> <div class=farm-pair> <div class="farm-icon pepperfarms-icon"></div> <div class=pepperfarms-count id=totalpepperfarmsCount></div> <div class=section-title>Pepper cultivation</div> </div> <div class=farm-pair> <div class="farm-icon teafarms-icon"></div> <div class=teafarms-count id=totalteafarmsCount></div> <div class=section-title>Tea cultivation</div> </div> </div> <div class=divider></div> <br> <div class=section-title>cultivate distribution</div> <p></p> <canvas id=treeTypeChart width=200 height=300></canvas> </div> </div> <!--Historical Soil Data Line Chart pop up--> <div id=popup-historicalsoildata class=popup-historicalsoildata style="display: none;"> <h4 class=title style="display: inline-flex; align-items: center;"> <span class=material-symbols-outlined style="margin-top: 3px;">speed</span>&nbsp;&nbsp;Current Measure </h4> <div class=canvas-container> <canvas id=npkGauge></canvas> <canvas id=moistGauge></canvas> <canvas id=pHGauge></canvas> <canvas id=tempGauge></canvas> <br> </div> <br> <div class=header> <h4 class=title><span class=material-symbols-outlined style="margin-top: 3px;">history</span>&nbsp;&nbsp;Historical Soil Data</h4> <button class=close-btn style="color: #555;">&times;</button> </div> <div class=timeTrend-buttons> <button>1D</button> <button>1W</button> <button>2W</button> <button>1M</button> <button>3M</button> <button>6M</button> <button>1Y</button> <button>3Y</button> <button>5Y</button> </div> <div class=divider></div> <!-- Divider line --> <div class=headerNPK> <h5 class=title> <span class=material-icons-outlined style="margin-top: 3px;">bubble_chart</span>&nbsp;&nbsp;Latest NPK </h5> <div id=npk-recommendation-container> <span id=npkreccomendation-tooltip class=tooltip> <span class=material-icons-outlined style="vertical-align: middle;">lightbulb</span>&nbsp; Recommendations: <p></p> </span> </div> </div> <br> <canvas id=npkChart></canvas> <div class=headerMoist> <h5 class=title> <span class=material-symbols-outlined style="margin-top: 3px;">humidity_mid</span>&nbsp;&nbsp;Latest Moisture </h5> <div id=moisture-recommendation-container> <span id=moisturerecommendation-tooltip class=tooltip> <span class=material-icons-outlined style="vertical-align: middle;">lightbulb</span>&nbsp; Recommendations: <p></p> </span> </div> </div> <br> <canvas id=moistChart></canvas> <div class=headerpH> <h5 class=title> <span class=material-symbols-outlined style="margin-top: 3px;">water_ph</span>&nbsp;&nbsp;Latest pH </h5> <div id=ph-recommendation-container> <span id=phrecommendation-tooltip class=tooltip> <span class=material-icons-outlined style="vertical-align: middle;">lightbulb</span>&nbsp; Recommendations: <p></p> </span> </div> </div> <br> <canvas id=phChart></canvas> <br> <div class=headerTemp> <h5 class=title> <span class=material-symbols-outlined style="margin-top: 3px;">device_thermostat</span>&nbsp;&nbsp;Latest Temp </h5> <div id=temp-recommendation-container> <span id=temprecommendation-tooltip class=tooltip> <span class=material-icons-outlined style="vertical-align: middle;">lightbulb</span>&nbsp; Recommendations: <p></p> </span> </div> </div> <br> <canvas id=tempChart></canvas> <br> </div> <script src=authenticateduser.js></script> <script src=mapbox3Dterrain.js></script> <script src=mapbox3Dsearch.js></script> <!--<script src="fetchFarmData.js"></script>--> <script src=mapboxpopup.js></script> <script src=infobox.js></script> <script src=mapboxrotation.js></script> <script src=mapboxraineffect.js></script> <script src=mapboxnightmode.js></script> <script src=mapboxsunsetmode.js></script> <script src=mapboxnortharrow.js></script> <script src=mapboxsimulationspanel.js></script> <script src=mapboxlinecharthistoricaldata.js></script> <script src=treetypecount.js></script> <script src=sumfarmarea.js></script> <script src=mapboxfarmlist.js></script> <!--<script src="popup.js"></script>--> <script src=fullscreen.js></script> <script>

        // Toggle slide menu stats
        function toggleSlideMenuStats() {
            const slideMenuStats = document.getElementById('slideMenuStats');
            slideMenuStats.classList.toggle('active');
        }

        //navigate to 2D leaflet map
        function switch2Dmap() {
            window.location.href = 'index.html';
        }




        document.addEventListener('DOMContentLoaded', function () {
            const instructionsButton = document.getElementById('instructionsButton');
            const instructionsWindow = document.getElementById('instructions-window');
            const closeInstructionsButton = document.getElementById('closeInstructions');

            // Function to toggle the instructions window
            function toggleInstructions() {
                if (instructionsWindow.style.display === 'none') {
                    instructionsWindow.style.display = 'block';
                } else {
                    instructionsWindow.style.display = 'none';
                }
            }

            // Event listener for the instructions button
            instructionsButton.addEventListener('click', toggleInstructions);

            // Event listener for the close button
            closeInstructionsButton.addEventListener('click', function () {
                instructionsWindow.style.display = 'none';
            });
        });
    </script> </body> </html>