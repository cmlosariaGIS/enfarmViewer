<!doctypehtml><meta charset=utf-8><title>enfarm 3D viewer</title><meta content="initial-scale=1,maximum-scale=1,user-scalable=no"name=viewport><link href=https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css rel=stylesheet><script src=https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js></script><link href=./mapbox3Dterrain.css rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Be+Vietnam:wght@400;500;600;700&display=swap"rel=stylesheet><link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js></script><script src=https://cdn.jsdelivr.net/npm/chart.js></script><script src=https://kit.fontawesome.com/0eb73cfc5c.js crossorigin=anonymous></script><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css rel=stylesheet><style>.north-arrow{position:absolute;top:20px;right:20px;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:99999}.north-arrow-icon{font-size:48px;text-shadow:0 0 5px rgba(109,109,109,.9);color:#383838}.north-text{position:absolute;top:40px;left:15px;font-size:20px;font-weight:bolder;color:red;text-shadow:0 0 5px rgba(0,0,0,.9)}</style><div id=map><canvas id=rainCanvas></canvas><div id=inset-map></div></div><a href=https://enfarm.com/ target=_blank><img alt="enfarm Logo"src=https://i.ibb.co/LdXsHXJ/enfarm-logo.png class=company-logo3D></a><div class=search-container><input class=search-input id=searchInput oninput=searchFeatures(this.value) placeholder=Search...> <button class=clear-button onclick=clearSearch() style=display:none><span class=material-icons-outlined>close</span></button></div><button class=switch2Dmap-button onclick=switch2Dmap()><span class=material-symbols-outlined>2d</span> <span class=tooltip-right>Switch to 2D Map View</span></button> <button class=mapbox3Dterrain-button onclick=switchBasemap()><span class=material-icons-outlined>landscape</span> <span class=tooltip-right>Switch Basemap</span></button> <button class=info-button onclick=toggleInfo()><span class=material-icons-outlined>info</span> <span class=tooltip-left>Show Info</span></button><div class=info-box><div class=info-content><div class=info-image></div><p>About<div class=info-logo><img alt="enFarm Logo"src=https://enfarm.com/fd57352e4cea98b4c1fb.jpg style=width:80px;height:auto></div><p>Map application to track and visualize deployed enfarm devices</p><button class=dismiss-button onclick=toggleInfo()>Dismiss</button></div></div><button class=simulationToggle-button onclick=toggleSimulationPanel()><span class=material-symbols-outlined>token</span> <span class=tooltip-right>Simulation</span></button><div class=simulation-buttons-container><button class=animateRotate-button onclick=toggleRotation(this)><span class=material-icons-outlined id=icon>play_circle</span></button> <button class=weatherToggle-button onclick=toggleRainEffect()><span class=material-symbols-outlined>rainy</span></button> <button class=nightToggle-button onclick=toggleNightEffect()><span class=material-symbols-outlined>nights_stay</span></button> <button class=sunsetToggle-button onclick=toggleSunsetEffect()><span class=material-symbols-outlined>wb_twilight</span></button><div class=simulation-panel><span class="material-symbols-outlined icon">token</span><h3 class=simulate-text>Simulate</h3><div class=bottom-animatetext><span>animate</span></div><div class=bottom-raintext><span>rain</span></div><div class=bottom-nighttext><span>night</span></div><div class=bottom-sunsettext><span>sunset</span></div></div></div><button class=stats-button onclick=toggleSlideMenuStats()><span class=material-icons-outlined>donut_large</span> <span class=tooltip-left>Show Dashboard</span></button><div class=slideMenuStats id=slideMenuStats><div class=slideMenuStats-content><span class="material-icons-outlined slideMenuStats-close"onclick=toggleSlideMenuStats()>close</span><h2 class=dashboard-title>Dashboard</h2><div class=device-count id=totalDevicesCount></div><div class=section-title>farms</div><br><div class=divider></div><br><div style=display:flex;align-items:center><img alt="Farm Icon"src=https://i.ibb.co/0QhPSvr/icons8-land-plot-64.png style=width:60px;height:60px;margin-right:8px;margin-top:-30px;color:#545454><div class=totalfarmarea-sum id=totalFarmAreaSum style=padding-bottom:5px></div></div><div class=section-title>total hectares</div><br><div class=divider></div><br><div class=farm-grid><div class=farm-pair><div class="farm-icon coffeefarms-icon"></div><div class=coffeefarms-count id=totalcoffeefarmsCount></div><div class=section-title>Coffee cultivation</div></div><div class=farm-pair><div class="farm-icon durianfarms-icon"></div><div class=durianfarms-count id=totaldurianfarmsCount></div><div class=section-title>Durian cultivation</div></div><div class=farm-pair><div class="farm-icon pepperfarms-icon"></div><div class=pepperfarms-count id=totalpepperfarmsCount></div><div class=section-title>Pepper cultivation</div></div><div class=farm-pair><div class="farm-icon teafarms-icon"></div><div class=teafarms-count id=totalteafarmsCount></div><div class=section-title>Tea cultivation</div></div></div><div class=divider></div><canvas id=treeTypeChart height=300 width=200></canvas></div></div><div class=popup-historicalsoildata id=popup-historicalsoildata style=display:none><div class=header><h4 class=title><span class=material-symbols-outlined style=margin-top:3px>history</span>  Historical Soil Data</h4><button class=close-btn>×</button></div><div class=divider></div><div class=headerNPK><h5 class=title><span class=material-symbols-outlined style=margin-top:3px>bubble_chart</span>  Latest NPK</h5></div><br><canvas id=npkChart></canvas><div class=headerMoist><h5 class=title><span class=material-symbols-outlined style=margin-top:3px>humidity_mid</span>  Latest Moisture</h5></div><br><canvas id=moistChart></canvas><div class=headerpH><h5 class=title><span class=material-symbols-outlined style=margin-top:3px>water_ph</span>  Latest pH</h5></div><br><canvas id=phChart></canvas><br><div class=headerTemp><h5 class=title><span class=material-symbols-outlined style=margin-top:3px>device_thermostat</span>  Latest Temp</h5></div><br><canvas id=tempChart></canvas><br></div><script src=mapbox3Dterrain.js></script><script src=mapbox3Dsearch.js></script><script src=mapboxpopup.js></script><script src=infobox.js></script><script src=mapboxrotation.js></script><script src=mapboxraineffect.js></script><script src=mapboxnightmode.js></script><script src=mapboxsunsetmode.js></script><script src=mapboxnortharrow.js></script><script src=mapboxsimulationspanel.js></script><script src=mapboxlinecharthistoricaldata.js></script><script src=treetypecount.js></script><script src=sumfarmarea.js></script><script>// Toggle slide menu stats
        function toggleSlideMenuStats() {
            const slideMenuStats = document.getElementById('slideMenuStats');
            slideMenuStats.classList.toggle('active');
        }

        //Filtered Device/Farm Count
        // Fetch the data from the API
        fetch('https://api-ma.enfarm.com/api/v1/ma/get-install-locations', {
            headers: { 'accept': 'application/json' }
        })
            .then(response => response.json())
            .then(data => {
                // Keyword filtering
                const excludedWords = ["toàn", "test", "enfarm", "koko"];
                const filteredLocations = data.content.filter(location => {
                    const farmNameContainsExcludedWord = excludedWords.some(word => location.farmname.toLowerCase().includes(word.toLowerCase()));
                    const regionNameContainsExcludedWord = excludedWords.some(word => location.region_name.toLowerCase().includes(word.toLowerCase()));
                    return !(farmNameContainsExcludedWord || regionNameContainsExcludedWord);
                });

                // Initialize total device count based on filtered locations
                var totalDevicesCount = filteredLocations.length;

                // Display total device count
                document.getElementById('totalDevicesCount').innerText = totalDevicesCount;
            })
            .catch(error => console.error('Error fetching data:', error));



        //navigate to 2D leaflet map
        function switch2Dmap() {
            window.location.href = 'index.html';
        }</script>
