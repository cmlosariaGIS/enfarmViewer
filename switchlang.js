window.currentLang='vi';window.getTranslatedText=function(key){return translations[currentLang][key]||key;}
const translations={en:{"Enterprise Platform":"Enterprise Platform","Switch Language":"Switch Language","Search":"Search","map":"Map","All Farms":"All Farms","farm(s)":"farm(s)","Alert":"Alert","Show farms needing attention":"Show farms needing attention","Durian":"Durian","Show Durian farms":"Show Durian farms","Coffee":"Coffee","Show Coffee farms":"Show Coffee farms","Pepper":"Pepper","Show Pepper farms":"Show Pepper farms","Tea":"Tea","Show Tea farms":"Show Tea farms","Managed Farms":"Managed Farms","Sort":"Sort","Status":"Status","Farm size":"Farm size","Last updated:":"Last updated:","Name":"Name","Produce":"Produce","Fetching farm data...":"Fetching farm data...","See Lists of Managed Farms":"See Lists of Managed Farms",'View Profile':'View Profile',"Settings":"Settings","Logout":"Logout","User Profile":"User Profile","About the Application":"About the Application","About":"About","Map application to track and visualize deployed enfarm devices":"Map application to track and visualize deployed enfarm devices","Dismiss":"Dismiss","Home":"Home","Locate User":"Locate User","Toggle fullscreen":"Toggle fullscreen","Toggle Inset Map":"Toggle Inset Map","Show Dashboard":"Show Dashboard","Dashboard":"Dashboard","farms":"farms","Land Area (Total)":"Land Area (Total)","enfarm devices deployed":"enfarm devices deployed","farms needing attention":"farms needing attention","Productivity (Total)":"Productivity (Total)","Current Prod.":"Current Prod.","Expected Prod.":"Expected Prod.","Coffee cultivation":"Coffee cultivation","Durian cultivation":"Durian cultivation","Pepper cultivation":"Pepper cultivation","Tea cultivation":"Tea cultivation","Other plants cultivation":"Other plants cultivation","cultivate distribution":"cultivate distribution","Current Measure":"Current Measure","Historical Soil Data":"Historical Soil Data","Latest Measure":"Latest Measure","Insufficient Nutrients":"Insufficient Nutrients","Average Nutrients":"Average Nutrients","Adequate Nutrients":"Adequate Nutrients","Excess Nutrients":"Excess Nutrients","Very dry":"Very dry","Lack of water":"Lack of water","Enough moisture":"Enough moisture","Excess water":"Excess water","Neutral":"Neutral","Very Acidic":"Very Acidic","Acidic":"Acidic","Slightly Acidic":"Slightly Acidic","Slightly Alkaline":"Slightly Alkaline","Alkaline":"Alkaline","Very Alkaline":"Very Alkaline","Low Temp":"Low Temp","Average Temp":"Average Temp","High Temp":"High Temp","Min":"Min","Max":"Max","No data":"No data","latest measure":"(latest measure)","Moisture (%)":"Moisture (%)","Temperature (¬∞c)":"Temperature (¬∞c)","Coffee":"Coffee","Durian":"Durian","Pepper":"Pepper","Tea":"Tea","Other Crops":"Other Crops","Show all":"Show all","Alert":"Alert","Show farms needing attention":"Show farms needing attention","Farm Area":"Farm Area","Tree Type":"Tree Type","Current Productivity":"Current Productivity","Expected Productivity":"Expected Productivity","Coffee":"Coffee","Durian":"Durian","Current Productivity":"Current Productivity","Expected Productivity":"Expected Productivity","Zoom in to Farm":"Zoom in to Farm","Visualize farm in 3D":"Visualize farm in 3D","View soil data":"View soil data","Hide soil data":"Hide soil data","See detailed soil data":"See detailed soil data","In Depth":"In Depth","Show historical soil data":"Show historical soil data","Moisture":"Moisture","Temperature":"Temperature","Last updated":"Last updated","No matching cultivate details found":"No matching cultivate details found","Farm details not found":"Farm details not found","Next":"‚Ä∫","Start/Stop":"Start/Stop","Previous":"‚Äπ","Adjust time:":"üïê Adjust time:","Adjust layer opacity:":"üåßÔ∏è Adjust layer opacity:","Real-time Radar Data":"Real-time Radar Data","Forecast":"Forecast","Past":"Past","Current":"Current","min":"min","min ago":"min ago","Source":"Source","Search...":"Search...","Search by farm name...":"Search by farm name...","Sorting":"Sorting","Switch to 2D Map View":"Switch to 2D Map View","Switch Basemap":"Switch Basemap","Simulation":"Simulation","Show Instructions":"Show Instructions","Navigating the 3D Map":"Navigating the 3D Map","Show farm information":"Show farm information","Pan the map":"Pan the map","Zoom the map view":"Zoom the map view","Rotate the map":"Rotate the map","Left mouse button click on a farm point":"Left mouse button click on a farm point","Left mouse button click + drag":"Left mouse button click + drag","Use the mouse scroll wheel":"Use the mouse scroll wheel","Right mouse button click + drag":"Right mouse button click + drag","Simulation":"Simulation","Simulate":"Simulate","animate":"animate","rain":"rain","night":"night","sunset":"sunset","Elevation":"Elevation","Moist":"Moist","Temp":"Temp","Very Low NDT":"Very Low NDT","Average NDT":"Average NDT","High NDT":"High NDT","Very Low P2O5":"Very Low P2O5","Average P2O5":"Average P2O5","High P2O5":"High P2O5","Very Low K2O":"Very Low K2O","Average K2O":"Average K2O","High K2O":"High K2O","Safe zone":"Safe Zone","Unsafe zone":"Unsafe Zone","Filter by Farmer":"Filter by Farmer","Apply Filter":"Apply Filter","Clear":"Clear","enfarm users, devices information":"enfarm users, devices information","Select a user":"Select a user","Select user":"Select user","User ID":"User ID","See User-Devices Information":"See User-Devices Information","Total Farm(s)":"Total Farm(s)","Total Sensor(s)":"Total Sensor(s)","Total Box(es)":"Total Box(es)","Total Gateway(s)":"Total Gateway(s)","Sensor(s) Installed":"Sensor(s) Installed","Box(es) Installed":"Box(es) Installed","Gateway(s) Installed":"Gateway(s) Installed","User Profile":"User Profile","Name:":"Name:","Phone:":"Phone:","Email:":"Email:","Date of Birth:":"Date of Birth:","Gender:":"Gender:","Male":"Male","Female":"Female","Farm Information":"Farm Information","Farm ID:":"Farm ID:","Address:":"Address:","Area:":"Area:","Tree Types:":"Tree Types:","Productivity":"Productivity","Fertilization Date:":"Fertilization Date:","Last Action Day":"Last Action Day","View on Map":"View on Map","Region and Cultivate Information":"Region and Cultivate Information","Region ID":"Region ID","Cultivate ID":"Cultivate ID","Region Name":"Region Name","Last Update":"Last Update","No region or cultivate information available":"No region or cultivate information available for this farm.","Sensor Information":"Sensor Information","Sensor ID":"Sensor ID","QR":"QR","Region Deployed":"Region Deployed","Depth":"Depth","Activated":"Activated","day":"day","days":"days","week":"week","weeks":"weeks","month":"month","months":"months","year":"year","years":"years","ago":"ago","No sensor information available":"No sensor(s) information available for this farm.","Box Information":"Box Information","Box ID":"Box ID","BL Address":"BL Address","No box information available":"No box(es) information available for this farm.","Gateway Information":"Gateway Information","Gateway ID":"Gateway ID","BL Address":"BL Address","No gateway information available":"No gateway(s) information available for this farm.","Growth Stage":"Growth Stage","Sensor(s) Deployed":"Sensor(s) Deployed","Box(es) Deployed":"Box(es) Deployed","Gateway(s) Deployed":"Gateway(s) Deployed","enfarm User Devices Information":"enfarm User Devices Information","Show enfarm devices":"Show enfarm devices"},vi:{"Enterprise Platform":"N·ªÅn t·∫£ng Doanh nghi·ªáp","Switch Language":"Chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ","Search":"T√¨m ki·∫øm","map":"B·∫£n ƒë·ªì","All Farms":"T·∫•t c·∫£ trang tr·∫°i","farm(s)":"(trang tr·∫°i)","Alert":"C·∫£nh b√°o","Show farms needing attention":"Hi·ªÉn th·ªã c√°c trang tr·∫°i c·∫ßn ch√∫ √Ω","Durian":"S·∫ßu ri√™ng","Show Durian farms":"Hi·ªÉn th·ªã c√°c trang tr·∫°i s·∫ßu ri√™ng","Coffee":"C√† ph√™","Show Coffee farms":"Hi·ªÉn th·ªã c√°c trang tr·∫°i c√† ph√™","Pepper":"Ti√™u","Show Pepper farms":"Hi·ªÉn th·ªã c√°c trang tr·∫°i ti√™u","Tea":"Tr√†","Show Tea farms":"Hi·ªÉn th·ªã c√°c trang tr·∫°i tr√†","Managed Farms":"C√°c trang tr·∫°i ƒë√£ qu·∫£n l√Ω","Sort":"Lo·∫°i","Status":"Tr·∫°ng th√°i","Farm size":"K√≠ch th∆∞·ªõc trang tr·∫°i","Last updated:":"C·∫≠p nh·∫≠t l·∫ßn cu·ªëi:","Name":"T√™n","Produce":"S·∫£n xu·∫•t","Fetching farm data...":"ƒêang l·∫•y d·ªØ li·ªáu trang tr·∫°i...","See Lists of Managed Farms":"Xem danh s√°ch c√°c trang tr·∫°i ƒë√£ qu·∫£n l√Ω",'View Profile':'Xem h·ªì s∆°',"Settings":"C√†i ƒë·∫∑t","Logout":"ƒêƒÉng xu·∫•t","User Profile":"Th√¥ng tin ng∆∞·ªùi d√πng","About the Application":"Th√¥ng tin ·ª©ng d·ª•ng","About":"Gi·ªõi thi·ªáu","Map application to track and visualize deployed enfarm devices":"·ª®ng d·ª•ng b·∫£n ƒë·ªì ƒë·ªÉ theo d√µi v√† hi·ªÉn th·ªã c√°c thi·∫øt b·ªã enfarm ƒë√£ tri·ªÉn khai","Dismiss":"ƒê√≥ng","Home":"Trang ch·ªß","Locate User":"ƒê·ªãnh v·ªã ng∆∞·ªùi d√πng","Toggle fullscreen":"Chuy·ªÉn ƒë·ªïi to√†n m√†n h√¨nh","Toggle Inset Map":"Chuy·ªÉn ƒë·ªïi b·∫£n ƒë·ªì l·ªìng gh√©p","Show Dashboard":"Hi·ªÉn th·ªã b·∫£ng ƒëi·ªÅu khi·ªÉn","Dashboard":"B·∫£ng ƒëi·ªÅu khi·ªÉn","farms":"trang tr·∫°i","Land Area (Total)":"Di·ªán t√≠ch ƒë·∫•t (T·ªïng c·ªông)","enfarm devices deployed":"thi·∫øt b·ªã enfarm ƒë√£ tri·ªÉn khai","farms needing attention":"trang tr·∫°i c·∫ßn ch√∫ √Ω","Productivity (Total)":"NƒÉng su·∫•t (T·ªïng c·ªông)","Current Prod.":"NƒÉng su·∫•t hi·ªán t·∫°i","Expected Prod.":"NƒÉng su·∫•t d·ª± ki·∫øn","Coffee cultivation":"Tr·ªìng c√† ph√™","Durian cultivation":"Tr·ªìng s·∫ßu ri√™ng","Pepper cultivation":"Tr·ªìng ti√™u","Tea cultivation":"Tr·ªìng tr√†","Other plants cultivation":"Tr·ªìng c√¢y kh√°c","cultivate distribution":"ph√¢n ph·ªëi canh t√°c","Current Measure":"ƒêo hi·ªán t·∫°i","Historical Soil Data":"D·ªØ li·ªáu ƒë·∫•t l·ªãch s·ª≠","Latest Measure":"ƒêo m·ªõi nh·∫•t","Insufficient Nutrients":"Thi·∫øu dinh d∆∞·ª°ng","Average Nutrients":"Dinh d∆∞·ª°ng trung b√¨nh","Adequate Nutrients":"Dinh d∆∞·ª°ng ƒë·ªß","Excess Nutrients":"D∆∞ dinh d∆∞·ª°ng","Very dry":"R·∫•t kh√¥","Lack of water":"Thi·∫øu n∆∞·ªõc","Enough moisture":"ƒê·ªô ·∫©m ƒë·ªß","Excess water":"D∆∞ n∆∞·ªõc","Neutral":"Trung t√≠nh","Very Acidic":"R·∫•t axit","Acidic":"Axit","Slightly Acidic":"H∆°i axit","Slightly Alkaline":"H∆°i ki·ªÅm","Alkaline":"Ki·ªÅm","Very Alkaline":"R·∫•t ki·ªÅm","Low Temp":"Nhi·ªát ƒë·ªô th·∫•p","Average Temp":"Nhi·ªát ƒë·ªô trung b√¨nh","High Temp":"Nhi·ªát ƒë·ªô cao","Min":"T·ªëi thi·ªÉu","Max":"T·ªëi ƒëa","No data":"Kh√¥ng c√≥ d·ªØ li·ªáu","latest measure":"(ƒëo l∆∞·ªùng m·ªõi nh·∫•t)","Moisture (%)":"ƒê·ªô ·∫©m (%)","Temperature (¬∞c)":"Nhi·ªát ƒë·ªô (¬∞c)","Coffee":"C√† ph√™","Durian":"S·∫ßu ri√™ng","Pepper":"Ti√™u","Tea":"Tr√†","Other Crops":"C√°c lo·∫°i c√¢y tr·ªìng kh√°c","Show all":"Hi·ªÉn th·ªã t·∫•t c·∫£","Alert":"C·∫£nh b√°o","Show farms needing attention":"Hi·ªÉn th·ªã c√°c trang tr·∫°i c·∫ßn ch√∫ √Ω","Farm Area":"Khu n√¥ng tr·∫°i","Tree Type":"Lo·∫°i c√¢y","Current Productivity":"NƒÉng su·∫•t hi·ªán t·∫°i","Expected Productivity":"NƒÉng su·∫•t d·ª± ki·∫øn","Coffee":"C√† ph√™","Durian":"S·∫ßu ri√™ng","Current Productivity":"NƒÉng su·∫•t hi·ªán t·∫°i","Expected Productivity":"NƒÉng su·∫•t d·ª± ki·∫øn","Zoom in to Farm":"Thu ph√≥ng ƒë·∫øn trang tr·∫°i","Visualize farm in 3D":"Hi·ªÉn th·ªã n√¥ng tr·∫°i trong 3D","View soil data":"Xem d·ªØ li·ªáu ƒë·∫•t","Hide soil data":"·∫®n d·ªØ li·ªáu ƒë·∫•t","See detailed soil data":"Xem d·ªØ li·ªáu ƒë·∫•t chi ti·∫øt","In Depth":"Chi·ªÅu s√¢u","Show historical soil data":"Xem d·ªØ li·ªáu l·ªãch s·ª≠ ƒë·∫•t","Moisture":"ƒê·ªô ·∫©m","Temperature":"Nhi·ªát ƒë·ªô","Last updated":"C·∫≠p nh·∫≠t m·ªõi nh·∫•t","No matching cultivate details found":"Kh√¥ng t√¨m th·∫•y chi ti·∫øt canh t√°c ph√π h·ª£p","Farm details not found":"Kh√¥ng t√¨m th·∫•y th√¥ng tin trang tr·∫°i","Next":"‚Ä∫","Start/Stop":"B·∫Øt ƒë·∫ßu/D·ª´ng","Previous":"‚Äπ","Adjust time:":"üïê ƒêi·ªÅu ch·ªânh th·ªùi gian:","Adjust layer opacity:":"üåßÔ∏è ƒêi·ªÅu ch·ªânh ƒë·ªô m·ªù c·ªßa l·ªõp:","Real-time Radar Data":"D·ªØ li·ªáu Radar Th·ªùi gian th·ª±c","Forecast":"D·ª± b√°o","Past":"Qu√° kh·ª©","Current":"Hi·ªán t·∫°i","min":"ph√∫t","min ago":"ph√∫t tr∆∞·ªõc","Source":"Ngu·ªìn","Search...":"T√¨m ki·∫øm...","Search by farm name...":"T√¨m ki·∫øm theo t√™n trang tr·∫°i...","Sorting":"ƒêang s·∫Øp x·∫øp","Switch to 2D Map View":"Chuy·ªÉn sang ch·∫ø ƒë·ªô xem b·∫£n ƒë·ªì 2D","Switch Basemap":"Chuy·ªÉn ƒë·ªïi b·∫£n ƒë·ªì c∆° s·ªü","Simulation":"M√¥ ph·ªèng","Show Instructions":"Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n","Navigating the 3D Map":"ƒêi·ªÅu h∆∞·ªõng b·∫£n ƒë·ªì 3D","Show farm information":"Hi·ªÉn th·ªã th√¥ng tin n√¥ng tr·∫°i","Pan the map":"Di chuy·ªÉn b·∫£n ƒë·ªì","Zoom the map view":"Thu ph√≥ng b·∫£n ƒë·ªì","Rotate the map":"Xoay b·∫£n ƒë·ªì","Left mouse button click on a farm point":"Nh·∫•p chu·ªôt tr√°i v√†o m·ªôt ƒëi·ªÉm n√¥ng tr·∫°i","Left mouse button click + drag":"Nh·∫•p chu·ªôt tr√°i + k√©o","Use the mouse scroll wheel":"S·ª≠ d·ª•ng b√°nh xe lƒÉn chu·ªôt","Right mouse button click + drag":"Nh·∫•p chu·ªôt ph·∫£i + k√©o","Simulation":"M√¥ ph·ªèng","Simulate":"M√¥ ph·ªèng","animate":"ho·∫°t h√¨nh","rain":"m∆∞a","night":"ƒë√™m","sunset":"ho√†ng h√¥n","Elevation":"ƒê·ªô cao","Moist":"ƒê·ªô ·∫©m","Temp":"Nhi·ªát ƒë·ªô","Very Low NDT":"NDT Ngh√®o","Average NDT":"NDT Trung b√¨nh","High NDT":"NDT Cao","Very Low P2O5":"P2O5 Ngh√®o","Average P2O5":"P2O5 Trung b√¨nh","High P2O5":"P2O5 Cao","Very Low K2O":"K2O Ngh√®o","Average K2O":"K2O Trung b√¨nh","High K2O":"K2O Cao","Safe zone":"V√πng an to√†n","Unsafe zone":"V√πng kh√¥ng an to√†n","Filter by Farmer":"L·ªçc theo N√¥ng d√¢n","Apply Filter":"√Åp d·ª•ng B·ªô l·ªçc","Clear":"X√≥a","enfarm users, devices information":"Th√¥ng tin ng∆∞·ªùi d√πng, thi·∫øt b·ªã enfarm","Select a user":"Ch·ªçn ng∆∞·ªùi d√πng","Select user":"Ch·ªçn ng∆∞·ªùi d√πng","User ID":"ID Ng∆∞·ªùi d√πng","See User-Devices Information":"Xem th√¥ng tin thi·∫øt b·ªã ng∆∞·ªùi d√πng","Total Farm(s)":"T·ªïng s·ªë Trang tr·∫°i","Total Sensor(s)":"T·ªïng s·ªë C·∫£m bi·∫øn","Total Box(es)":"T·ªïng s·ªë H·ªôp","Total Gateway(s)":"T·ªïng s·ªë Gateway","Sensor(s) Installed":"C·∫£m bi·∫øn ƒë√£ l·∫Øp ƒë·∫∑t","Box(es) Installed":"H·ªôp ƒë√£ l·∫Øp ƒë·∫∑t","Gateway(s) Installed":"C·ªïng ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t","User Profile":"H·ªì s∆° Ng∆∞·ªùi d√πng","Name:":"T√™n:","Phone:":"ƒêi·ªán tho·∫°i:","Email:":"Email:","Date of Birth:":"Ng√†y sinh:","Gender:":"Gi·ªõi t√≠nh","Male":"Nam","Female":"N·ªØ","Farm Information":"Th√¥ng tin Trang tr·∫°i","Farm ID:":"ID Trang tr·∫°i:","Address:":"ƒê·ªãa ch·ªâ:","Area:":"Di·ªán t√≠ch:","Tree Types:":"Lo·∫°i c√¢y:","Productivity:":"NƒÉng su·∫•t:","Fertilization Date:":"Ng√†y b√≥n ph√¢n:","Last Action Day:":"Ng√†y ho·∫°t ƒë·ªông cu·ªëi c√πng:","View on Map":"Xem tr√™n B·∫£n ƒë·ªì","Region and Cultivate Information":"Th√¥ng tin V√πng v√† Canh t√°c","Region ID":"ID V√πng","Cultivate ID":"ID Canh t√°c","Region Name":"T√™n V√πng","Last Update":"C·∫≠p nh·∫≠t l·∫ßn cu·ªëi","No region or cultivate information available":"Kh√¥ng c√≥ th√¥ng tin v√πng ho·∫∑c canh t√°c cho trang tr·∫°i n√†y.","Sensor Information":"Th√¥ng tin C·∫£m bi·∫øn","Sensor ID":"ID C·∫£m bi·∫øn","QR":"QR","Region Deployed":"Khu v·ª±c tri·ªÉn khai","Depth":"ƒê·ªô s√¢u","Activated":"ƒê√£ k√≠ch ho·∫°t","day":"ng√†y","days":"ng√†y","week":"tu·∫ßn","weeks":"tu·∫ßn","month":"th√°ng","months":"th√°ng","year":"nƒÉm","years":"nƒÉm","ago":"tr∆∞·ªõc","No sensor information available":"Kh√¥ng c√≥ th√¥ng tin c·∫£m bi·∫øn n√†o cho trang tr·∫°i n√†y.","Box Information":"Th√¥ng tin H·ªôp","Box ID":"ID H·ªôp","BL Address":"ƒê·ªãa ch·ªâ BL","No box information available":"Kh√¥ng c√≥ th√¥ng tin h·ªôp n√†o cho trang tr·∫°i n√†y.","Gateway Information":"Th√¥ng tin c·ªïng th√¥ng tin","Gateway ID":"ID c·ªïng","BL Address":"ƒê·ªãa ch·ªâ BL","No gateway information available":"Kh√¥ng c√≥ th√¥ng tin c·ªïng th√¥ng tin n√†o c√≥ s·∫µn cho trang tr·∫°i n√†y.","Growth Stage":"Giai ƒêo·∫°n","Sensor(s) Deployed":"C·∫£m bi·∫øn ƒë∆∞·ª£c tri·ªÉn khai","Box(es) Deployed":"H·ªôp ƒë∆∞·ª£c tri·ªÉn khai","Gateway(s) Deployed":"C·ªïng ƒë√£ tri·ªÉn khai","enfarm User Devices Information":"Th√¥ng tin thi·∫øt b·ªã ng∆∞·ªùi d√πng enfarm","Show enfarm devices":"Hi·ªÉn th·ªã thi·∫øt b·ªã enfarm",}};let currentLang=localStorage.getItem('selectedLanguage')||'vi';document.addEventListener('DOMContentLoaded',function(){translateAllElements();const langSwitchButton=document.getElementById('lang-switch');if(langSwitchButton){langSwitchButton.innerText=currentLang==='vi'?'EN ':'VN ';langSwitchButton.innerHTML+=currentLang==='vi'?'<i class="fa-solid fa-earth-americas"></i>':'<i class="fa-solid fa-earth-asia"></i>';}});window.translateAllElements=function(){const elements=document.querySelectorAll('[data-translate]');elements.forEach(element=>{const key=element.getAttribute('data-translate');if(element.classList.contains('tree-type')){element.textContent=getTranslatedText(key);}else{element.textContent=translations[currentLang][key]||element.textContent;}});const pepperButton=document.querySelector('.pepperFarms-filter');if(pepperButton){pepperButton.style.right=currentLang==='vi'?'408px':'390px';}
const langSwitchButton=document.getElementById('lang-switch');if(langSwitchButton){langSwitchButton.innerText=currentLang==='vi'?'EN ':'VN ';langSwitchButton.innerHTML+=currentLang==='vi'?'<i class="fa-solid fa-earth-americas"></i>':'<i class="fa-solid fa-earth-asia"></i>';}
updateDynamicContent();updateChartsLanguage();updateRecommendationTooltips();const event=new CustomEvent('languageChanged',{detail:{language:currentLang}});window.dispatchEvent(event);document.querySelectorAll('.tree-type[data-translate]').forEach(element=>{const key=element.getAttribute('data-translate');element.textContent=getTranslatedText(key);});}
function toggleLanguage(){const elements=document.querySelectorAll('[data-translate]');const pepperButton=document.querySelector('.pepperFarms-filter');const langSwitchButton=document.getElementById('lang-switch');currentLang=currentLang==='vi'?'en':'vi';langSwitchButton.innerText=currentLang==='vi'?'EN ':'VN ';langSwitchButton.innerHTML+=currentLang==='vi'?'<i class="fa-solid fa-earth-americas"></i>':'<i class="fa-solid fa-earth-asia"></i>';elements.forEach(element=>{const key=element.getAttribute('data-translate');element.innerText=translations[currentLang][key]||element.innerText;});document.querySelectorAll('[data-translate]').forEach(element=>{const key=element.getAttribute('data-translate');if(element.classList.contains('tree-type')){element.textContent=getTranslatedText(key);}else{element.textContent=translations[currentLang][key]||element.textContent;}});if(currentLang==='vi'){pepperButton.style.right='408px';}else{pepperButton.style.right='390px';}
const selectedUserId=document.getElementById('userSelect').value;if(selectedUserId){getFarmData(selectedUserId);}
map.eachLayer(function(layer){if(layer instanceof L.Marker){const popup=layer.getPopup();if(popup){const content=popup.getContent();if(content&&typeof content==='string'){const updatedContent=updatePopupContent(content);popup.setContent(updatedContent);if(layer.isPopupOpen()){popup.update();}}}}});if(currentFilteredMarkers){currentFilteredMarkers.eachLayer(function(layer){if(layer instanceof L.Marker){const popup=layer.getPopup();if(popup){const content=popup.getContent();if(content&&typeof content==='string'){const updatedContent=updatePopupContent(content);popup.setContent(updatedContent);if(layer.isPopupOpen()){popup.update();}}}}});}
const event=new CustomEvent('languageChanged',{detail:{language:currentLang}});window.dispatchEvent(event);if(typeof mapboxgl!=='undefined'&&mapboxMap instanceof mapboxgl.Map){updateAllPopups();}
displayTextWithTypingEffect();updateChartsLanguage();updateChartLanguage();updateDynamicContent();updateNutrientStatus();updateMoistureStatus();updatePHStatus();updateTempStatus();updateNdtStatus();updateP205Status();updatek2oStatus();updateRecommendationHeaders();updateRecommendationTooltips();updateOpenPopup();updateRainViewerTexts();if(rainviewer){rainviewer.options.positionSliderLabelText=getTranslatedText("Adjust time:");rainviewer.options.opacitySliderLabelText=getTranslatedText("Adjust layer opacity:");rainviewer.options.playStopButtonText=getTranslatedText("Start/Stop");if(rainviewer.rainviewerActive){updateRainViewerTexts();}
rainviewer.unload();}
localStorage.setItem('selectedLanguage',currentLang);document.querySelectorAll('.tree-type[data-translate]').forEach(element=>{const key=element.getAttribute('data-translate');element.textContent=getTranslatedText(key);});}
window.getTranslatedText=function(key){return translations[window.currentLang][key]||key;}
function updatePopupContent(content){if(typeof content!=='string')return content;const tempDiv=document.createElement('div');tempDiv.innerHTML=content;const elementsToTranslate=tempDiv.querySelectorAll('[data-translate]');elementsToTranslate.forEach(element=>{const key=element.getAttribute('data-translate');element.textContent=getTranslatedText(key);});const noCultivateDetails=tempDiv.querySelector('.no-cultivate-details');if(noCultivateDetails){noCultivateDetails.innerHTML=`<i data-translate="No matching cultivate details found">${getTranslatedText("No matching cultivate details found")}</i>`;}
const noFarmDetails=tempDiv.querySelector('.no-farm-details');if(noFarmDetails){noFarmDetails.innerHTML=`<i data-translate="Farm details not found">${getTranslatedText("Farm details not found")}</i>`;}
return tempDiv.innerHTML;}
function updateDynamicContent(){const showAllSpan=document.querySelector('.needs-attention span[data-translate="Show all"]');if(showAllSpan){showAllSpan.textContent=translations[currentLang]["Show all"];}
const alertSpan=document.querySelector('.needs-attention .attention-text');if(alertSpan){alertSpan.textContent=translations[currentLang]["Alert"];}
const tooltipSpan=document.querySelector('.needs-attention .tooltip-bottom');if(tooltipSpan){tooltipSpan.textContent=translations[currentLang]["Show farms needing attention"];}}
function updateChartsLanguage(){const newMoistureLabel=currentLang==='vi'?"ƒê·ªô ·∫©m (%)":"Moisture (%)";const newTemperatureLabel=currentLang==='vi'?"Nhi·ªát ƒë·ªô (¬∞C)":"Temperature (¬∞C)";if(typeof moistChart!=='undefined'&&moistChart!==null){moistChart.data.datasets[0].label=newMoistureLabel;moistChart.update();}
if(typeof tempChart!=='undefined'&&tempChart!==null){tempChart.data.datasets[0].label=newTemperatureLabel;tempChart.update();}
if(typeof treeTypeChart!=='undefined'&&treeTypeChart!==null){updateChartLanguage();}}
function getTranslatedLabels(){return[translations[currentLang]["Coffee"],translations[currentLang]["Durian"],translations[currentLang]["Pepper"],translations[currentLang]["Tea"],translations[currentLang]["Other Crops"]];}
function updateChartLanguage(){if(treeTypeChart){const newLabels=getTranslatedLabels();treeTypeChart.data.labels=newLabels;treeTypeChart.options.plugins.legend.labels.generateLabels=function(chart){return newLabels.map((label,i)=>({text:label,fillStyle:chart.data.datasets[0].backgroundColor[i],hidden:false,index:i}));};treeTypeChart.update();}}
function updateRecommendationTooltips(){const tooltipContainers=['npk-recommendation-container','moisture-recommendation-container','ph-recommendation-container','temp-recommendation-container','ndt-recommendation-container','p205-recommendation-container','k2o-recommendation-container'];tooltipContainers.forEach(containerId=>{const container=document.getElementById(containerId);if(container){const tooltipContent=container.querySelector('p');if(tooltipContent){const status=getStatusFromContainer(containerId);const recommendations=getRecommendationFunction(containerId)(status);tooltipContent.innerHTML=recommendations[currentLang];}else{}}else{}});}
function getStatusFromContainer(containerId){let statusClass=containerId.replace('-recommendation-container','-status');if(containerId==='npk-recommendation-container'){statusClass='nutrient-status';}
const statusElement=document.querySelector(`.${statusClass}`);if(statusElement){const statusSpan=statusElement.querySelector('span[data-translate]');if(statusSpan){return statusSpan.getAttribute('data-translate');}
return statusElement.textContent.trim();}
return'No data';}
function getRecommendationFunction(containerId){switch(containerId){case'npk-recommendation-container':return getNutrientRecommendation;case'moisture-recommendation-container':return getMoistureRecommendation;case'ph-recommendation-container':return getPHRecommendation;case'temp-recommendation-container':return getTempRecommendation;case'ndt-recommendation-container':return getNdtRecommendation;case'p205-recommendation-container':return getP205Recommendation;case'k2o-recommendation-container':return getk2oRecommendation;default:return()=>({en:"",vi:""});}}
function updateRecommendationHeaders(){const headers=document.querySelectorAll('.recommendation-header');headers.forEach(header=>{header.textContent=currentLang==='en'?'Recommendations:':'Khuy·∫øn ngh·ªã:';});}
function updateNutrientStatus(){const nutrientStatusElement=document.querySelector('.nutrient-status span[data-translate]');if(nutrientStatusElement){const key=nutrientStatusElement.getAttribute('data-translate');nutrientStatusElement.textContent=getTranslatedText(key);}}
function updateMoistureStatus(){const moistureStatusElement=document.querySelector('.moisture-status span[data-translate]');if(moistureStatusElement){const key=moistureStatusElement.getAttribute('data-translate');moistureStatusElement.textContent=getTranslatedText(key);}}
function updatePHStatus(){const phStatusElement=document.querySelector('.ph-status span[data-translate]');if(phStatusElement){const key=phStatusElement.getAttribute('data-translate');phStatusElement.textContent=getTranslatedText(key);}}
function updateTempStatus(){const tempStatusElement=document.querySelector('.temp-status span[data-translate]');if(tempStatusElement){const key=tempStatusElement.getAttribute('data-translate');tempStatusElement.textContent=getTranslatedText(key);}}
function updateNdtStatus(){const ndtStatusElement=document.querySelector('.ndt-status span[data-translate]');if(ndtStatusElement){const key=ndtStatusElement.getAttribute('data-translate');ndtStatusElement.textContent=getTranslatedText(key);}}
function updateP205Status(){const p205StatusElement=document.querySelector('.p205-status span[data-translate]');if(p205StatusElement){const key=p205StatusElement.getAttribute('data-translate');p205StatusElement.textContent=getTranslatedText(key);}}
function updatek2oStatus(){const k2oStatusElement=document.querySelector('.k2o-status span[data-translate]');if(k2oStatusElement){const key=k2oStatusElement.getAttribute('data-translate');k2oStatusElement.textContent=getTranslatedText(key);}}
function updateRainViewerTexts(){if(rainviewer&&rainviewer._container){const elements={playStopButton:rainviewer._container.querySelector('.leaflet-control-rainviewer-startstop'),positionLabel:rainviewer._container.querySelector('.leaflet-control-rainviewer-label[for="rainviewer-positionslider"]'),opacityLabel:rainviewer._container.querySelector('.leaflet-control-rainviewer-label[for="rainviewer-opacityslider"]'),realTimeText:rainviewer._container.querySelector('.real-time-text'),timestampElement:rainviewer._container.querySelector('#timestamp')};if(elements.playStopButton){elements.playStopButton.value=getTranslatedText("Start/Stop");}
if(elements.positionLabel){elements.positionLabel.textContent=getTranslatedText("Adjust time:");}
if(elements.opacityLabel){elements.opacityLabel.textContent=getTranslatedText("Adjust layer opacity:");}
if(elements.realTimeText){elements.realTimeText.textContent=getTranslatedText("Real-time Radar Data");}
if(elements.timestampElement){const currentText=elements.timestampElement.textContent;const updatedText=currentText.replace(/Forecast/g,getTranslatedText("Forecast")).replace(/Past/g,getTranslatedText("Past")).replace(/\bmin\b/g,getTranslatedText("min")).replace(/ago/g,getTranslatedText("min ago").replace('min ',''));elements.timestampElement.textContent=updatedText;}}}