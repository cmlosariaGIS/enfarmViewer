window.currentLang='vi';window.getTranslatedText=function(key){return translations[currentLang][key]||key;}
const translations={en:{"Enterprise Platform":"Enterprise Platform","Switch Language":"Switch Language","Search":"Search",map:"Map","All Farms":"All Farms","farm(s)":"farm(s)",Alert:"Alert","Show farms needing attention":"Show farms needing attention",Durian:"Durian","Show Durian farms":"Show Durian farms",Coffee:"Coffee","Show Coffee farms":"Show Coffee farms",Pepper:"Pepper","Show Pepper farms":"Show Pepper farms",Tea:"Tea","Show Tea farms":"Show Tea farms","Managed Farms":"Managed Farms","Sort":"Sort",Status:"Status","Farm size":"Farm size","Last updated:":"Last updated:",Name:"Name",Produce:"Produce","Fetching farm data...":"Fetching farm data...","See lists of managed farms":"See lists of managed farms",Logout:"Logout","About the Application":"About the Application",About:"About","Map application to track and visualize deployed enfarm devices":"Map application to track and visualize deployed enfarm devices",Dismiss:"Dismiss","Locate User":"Locate User","Toggle fullscreen":"Toggle fullscreen","Toggle Inset Map":"Toggle Inset Map","Show Dashboard":"Show Dashboard",Dashboard:"Dashboard",farms:"farms","Land Area (Total)":"Land Area (Total)","enfarm devices deployed":"enfarm devices deployed","farms needing attention":"farms needing attention","Productivity (Total)":"Productivity (Total)","Current Prod.":"Current Prod.","Expected Prod.":"Expected Prod.","Coffee cultivation":"Coffee cultivation","Durian cultivation":"Durian cultivation","Pepper cultivation":"Pepper cultivation","Tea cultivation":"Tea cultivation","cultivate distribution":"cultivate distribution","Current Measure":"Current Measure","Historical Soil Data":"Historical Soil Data","Latest Measure":"Latest Measure","Insufficient Nutrients":"Insufficient Nutrients","Average Nutrients":"Average Nutrients","Adequate Nutrients":"Adequate Nutrients","Excess Nutrients":"Excess Nutrients","Very dry":"Very dry","Lack of water":"Lack of water","Enough moisture":"Enough moisture","Excess water":"Excess water","Neutral":"Neutral","Very Acidic":"Very Acidic","Acidic":"Acidic","Slightly Acidic":"Slightly Acidic","Slightly Alkaline":"Slightly Alkaline","Alkaline":"Alkaline","Very Alkaline":"Very Alkaline","Low Temp":"Low Temp","Average Temp":"Average Temp","High Temp":"High Temp","Min":"Min","Max":"Max","No data":"No data","latest measure":"(latest measure)","Moisture (%)":"Moisture (%)","Temperature (Â°c)":"Temperature (Â°c)","Coffee":"Coffee","Durian":"Durian","Pepper":"Pepper","Tea":"Tea","Show all":"Show all","Alert":"Alert","Show farms needing attention":"Show farms needing attention","Farm Area":"Farm Area","Tree Type":"Tree Type","Current Productivity":"Current Productivity","Expected Productivity":"Expected Productivity","Coffee":"Coffee","Durian":"Durian","Current Productivity":"Current Productivity","Expected Productivity":"Expected Productivity","Zoom to Farm":"Zoom to Farm","Visualize farm in 3D":"Visualize farm in 3D","View soil data":"View soil data","Hide soil data":"Hide soil data","See detailed soil data available":"See detailed soil data available","In Depth":"In Depth","Show historical soil data":"Show historical soil data","Moisture":"Moisture","Temperature":"Temperature","Last updated":"Last updated","No matching cultivate details found":"No matching cultivate details found","Farm details not found":"Farm details not found","Next":"â€º","Start/Stop":"Start/Stop","Previous":"â€¹","Adjust time:":"ðŸ• Adjust time:","Adjust layer opacity:":"ðŸŒ§ï¸ Adjust layer opacity:","Real-time Radar Data":"Real-time Radar Data","Forecast":"Forecast","Past":"Past","Current":"Current","min":"min","min ago":"min ago","Source":"Source","Search...":"Search...","Search by farm name...":"Search by farm name..."},vi:{"Enterprise Platform":"Ná»n táº£ng Doanh nghiá»‡p","Switch Language":"Chuyá»ƒn Ä‘á»•i ngÃ´n ngá»¯","Search":"TÃ¬m kiáº¿m",map:"Báº£n Ä‘á»“","All Farms":"Táº¥t cáº£ trang tráº¡i","farm(s)":"(trang tráº¡i)",Alert:"Cáº£nh bÃ¡o","Show farms needing attention":"Hiá»ƒn thá»‹ cÃ¡c trang tráº¡i cáº§n chÃº Ã½",Durian:"Sáº§u riÃªng","Show Durian farms":"Hiá»ƒn thá»‹ cÃ¡c trang tráº¡i sáº§u riÃªng",Coffee:"CÃ  phÃª","Show Coffee farms":"Hiá»ƒn thá»‹ cÃ¡c trang tráº¡i cÃ  phÃª",Pepper:"TiÃªu","Show Pepper farms":"Hiá»ƒn thá»‹ cÃ¡c trang tráº¡i tiÃªu",Tea:"TrÃ ","Show Tea farms":"Hiá»ƒn thá»‹ cÃ¡c trang tráº¡i trÃ ","Managed Farms":"CÃ¡c trang tráº¡i Ä‘Ã£ quáº£n lÃ½","Sort":"Loáº¡i",Status:"Tráº¡ng thÃ¡i","Farm size":"KÃ­ch thÆ°á»›c trang tráº¡i","Last updated:":"Cáº­p nháº­t láº§n cuá»‘i:",Name:"TÃªn",Produce:"Sáº£n xuáº¥t","Fetching farm data...":"Äang láº¥y dá»¯ liá»‡u trang tráº¡i...","See lists of managed farms":"Xem danh sÃ¡ch cÃ¡c trang tráº¡i Ä‘Ã£ quáº£n lÃ½",Logout:"ÄÄƒng xuáº¥t","About the Application":"ThÃ´ng tin á»©ng dá»¥ng",About:"Giá»›i thiá»‡u","Map application to track and visualize deployed enfarm devices":"á»¨ng dá»¥ng báº£n Ä‘á»“ Ä‘á»ƒ theo dÃµi vÃ  hiá»ƒn thá»‹ cÃ¡c thiáº¿t bá»‹ enfarm Ä‘Ã£ triá»ƒn khai",Dismiss:"ÄÃ³ng","Locate User":"Äá»‹nh vá»‹ ngÆ°á»i dÃ¹ng","Toggle fullscreen":"Chuyá»ƒn Ä‘á»•i toÃ n mÃ n hÃ¬nh","Toggle Inset Map":"Chuyá»ƒn Ä‘á»•i báº£n Ä‘á»“ lá»“ng ghÃ©p","Show Dashboard":"Hiá»ƒn thá»‹ báº£ng Ä‘iá»u khiá»ƒn",Dashboard:"Báº£ng Ä‘iá»u khiá»ƒn",farms:"trang tráº¡i","Land Area (Total)":"Diá»‡n tÃ­ch Ä‘áº¥t (Tá»•ng cá»™ng)","enfarm devices deployed":"thiáº¿t bá»‹ enfarm Ä‘Ã£ triá»ƒn khai","farms needing attention":"trang tráº¡i cáº§n chÃº Ã½","Productivity (Total)":"NÄƒng suáº¥t (Tá»•ng cá»™ng)","Current Prod.":"NÄƒng suáº¥t hiá»‡n táº¡i","Expected Prod.":"NÄƒng suáº¥t dá»± kiáº¿n","Coffee cultivation":"Trá»“ng cÃ  phÃª","Durian cultivation":"Trá»“ng sáº§u riÃªng","Pepper cultivation":"Trá»“ng tiÃªu","Tea cultivation":"Trá»“ng trÃ ","cultivate distribution":"phÃ¢n phá»‘i canh tÃ¡c","Current Measure":"Äo hiá»‡n táº¡i","Historical Soil Data":"Dá»¯ liá»‡u Ä‘áº¥t lá»‹ch sá»­","Latest Measure":"Äo má»›i nháº¥t","Insufficient Nutrients":"Thiáº¿u dinh dÆ°á»¡ng","Average Nutrients":"Dinh dÆ°á»¡ng trung bÃ¬nh","Adequate Nutrients":"Dinh dÆ°á»¡ng Ä‘á»§","Excess Nutrients":"DÆ° dinh dÆ°á»¡ng","Very dry":"Ráº¥t khÃ´","Lack of water":"Thiáº¿u nÆ°á»›c","Enough moisture":"Äá»™ áº©m Ä‘á»§","Excess water":"DÆ° nÆ°á»›c","Neutral":"Trung tÃ­nh","Very Acidic":"Ráº¥t axit","Acidic":"Axit","Slightly Acidic":"HÆ¡i axit","Slightly Alkaline":"HÆ¡i kiá»m","Alkaline":"Kiá»m","Very Alkaline":"Ráº¥t kiá»m","Low Temp":"Nhiá»‡t Ä‘á»™ tháº¥p","Average Temp":"Nhiá»‡t Ä‘á»™ trung bÃ¬nh","High Temp":"Nhiá»‡t Ä‘á»™ cao","Min":"Tá»‘i thiá»ƒu","Max":"Tá»‘i Ä‘a","No data":"KhÃ´ng cÃ³ dá»¯ liá»‡u","latest measure":"(Ä‘o lÆ°á»ng má»›i nháº¥t)","Moisture (%)":"Äá»™ áº©m (%)","Temperature (Â°c)":"Nhiá»‡t Ä‘á»™ (Â°c)","Coffee":"CÃ  phÃª","Durian":"Sáº§u riÃªng","Pepper":"TiÃªu","Tea":"TrÃ ","Show all":"Hiá»ƒn thá»‹ táº¥t cáº£","Alert":"Cáº£nh bÃ¡o","Show farms needing attention":"Hiá»ƒn thá»‹ cÃ¡c trang tráº¡i cáº§n chÃº Ã½","Farm Area":"Khu nÃ´ng tráº¡i","Tree Type":"Loáº¡i cÃ¢y","Current Productivity":"NÄƒng suáº¥t hiá»‡n táº¡i","Expected Productivity":"NÄƒng suáº¥t dá»± kiáº¿n","Coffee":"CÃ  phÃª","Durian":"Sáº§u riÃªng","Current Productivity":"NÄƒng suáº¥t hiá»‡n táº¡i","Expected Productivity":"NÄƒng suáº¥t dá»± kiáº¿n","Zoom to Farm":"Thu phÃ³ng Ä‘áº¿n trang tráº¡i","Visualize farm in 3D":"Hiá»ƒn thá»‹ nÃ´ng tráº¡i trong 3D","View soil data":"Xem dá»¯ liá»‡u Ä‘áº¥t","Hide soil data":"áº¨n dá»¯ liá»‡u Ä‘áº¥t","See detailed soil data available":"Xem dá»¯ liá»‡u Ä‘áº¥t chi tiáº¿t cÃ³ sáºµn","In Depth":"Chiá»u sÃ¢u","Show historical soil data":"Xem dá»¯ liá»‡u lá»‹ch sá»­ Ä‘áº¥t","Moisture":"Äá»™ áº©m","Temperature":"Nhiá»‡t Ä‘á»™","Last updated":"Cáº­p nháº­t má»›i nháº¥t","No matching cultivate details found":"KhÃ´ng tÃ¬m tháº¥y chi tiáº¿t canh tÃ¡c phÃ¹ há»£p","Farm details not found":"KhÃ´ng tÃ¬m tháº¥y thÃ´ng tin trang tráº¡i","Next":"â€º","Start/Stop":"Báº¯t Ä‘áº§u/Dá»«ng","Previous":"â€¹","Adjust time:":"ðŸ• Äiá»u chá»‰nh thá»i gian:","Adjust layer opacity:":"ðŸŒ§ï¸ Äiá»u chá»‰nh Ä‘á»™ má» cá»§a lá»›p:","Real-time Radar Data":"Dá»¯ liá»‡u Radar Thá»i gian thá»±c","Forecast":"Dá»± bÃ¡o","Past":"QuÃ¡ khá»©","Current":"Hiá»‡n táº¡i","min":"phÃºt","min ago":"phÃºt trÆ°á»›c","Source":"Nguá»“n","Search...":"TÃ¬m kiáº¿m...","Search by farm name...":"TÃ¬m kiáº¿m theo tÃªn trang tráº¡i..."}};let currentLang='vi';function translateAllElements(){const elements=document.querySelectorAll('[data-translate]');elements.forEach(element=>{const key=element.getAttribute('data-translate');element.innerText=translations[currentLang][key]||element.innerText;});const pepperButton=document.querySelector('.pepperFarms-filter');pepperButton.style.right=currentLang==='vi'?'408px':'390px';const langSwitchButton=document.getElementById('lang-switch');langSwitchButton.innerText=currentLang==='vi'?'EN ':'VN ';langSwitchButton.innerHTML+=currentLang==='vi'?'<i class="fa-solid fa-earth-americas"></i>':'<i class="fa-solid fa-earth-asia"></i>';console.log(`Initial language:${currentLang==='en'?'English':'Vietnamese'}`);}
document.addEventListener('DOMContentLoaded',translateAllElements);function toggleLanguage(){const elements=document.querySelectorAll('[data-translate]');const pepperButton=document.querySelector('.pepperFarms-filter');const langSwitchButton=document.getElementById('lang-switch');currentLang=currentLang==='vi'?'en':'vi';console.log(`Current language:${currentLang==='en'?'English':'Vietnamese'}`);langSwitchButton.innerText=currentLang==='vi'?'EN ':'VN ';langSwitchButton.innerHTML+=currentLang==='vi'?'<i class="fa-solid fa-earth-americas"></i>':'<i class="fa-solid fa-earth-asia"></i>';elements.forEach(element=>{const key=element.getAttribute('data-translate');element.innerText=translations[currentLang][key]||element.innerText;});document.querySelectorAll('[data-translate]').forEach(element=>{const key=element.getAttribute('data-translate');element.textContent=translations[currentLang][key]||element.textContent;});if(currentLang==='vi'){pepperButton.style.right='408px';}else{pepperButton.style.right='390px';}
map.eachLayer(function(layer){if(layer instanceof L.Marker){const popup=layer.getPopup();if(popup){const content=popup.getContent();if(content&&typeof content==='string'){const updatedContent=updatePopupContent(content);popup.setContent(updatedContent);if(layer.isPopupOpen()){popup.update();}}}}});if(currentFilteredMarkers){currentFilteredMarkers.eachLayer(function(layer){if(layer instanceof L.Marker){const popup=layer.getPopup();if(popup){const content=popup.getContent();if(content&&typeof content==='string'){const updatedContent=updatePopupContent(content);popup.setContent(updatedContent);if(layer.isPopupOpen()){popup.update();}}}}});}
displayTextWithTypingEffect();updateChartsLanguage();updateChartLanguage();updateDynamicContent();updateNutrientStatus();updateMoistureStatus();updatePHStatus();updateTempStatus();updateRecommendationHeaders();updateRecommendationTooltips();updateOpenPopup();updateRainViewerTexts();if(rainviewer){rainviewer.options.positionSliderLabelText=getTranslatedText("Adjust time:");rainviewer.options.opacitySliderLabelText=getTranslatedText("Adjust layer opacity:");rainviewer.options.playStopButtonText=getTranslatedText("Start/Stop");if(rainviewer.rainviewerActive){updateRainViewerTexts();}}
rainviewer.unload();if(rainviewer&&rainviewer.rainviewerActive){updateRainViewerTexts();}}
window.getTranslatedText=function(key){return translations[window.currentLang][key]||key;}
function updatePopupContent(content){if(typeof content!=='string')return content;const tempDiv=document.createElement('div');tempDiv.innerHTML=content;const elementsToTranslate=tempDiv.querySelectorAll('[data-translate]');elementsToTranslate.forEach(element=>{const key=element.getAttribute('data-translate');element.textContent=getTranslatedText(key);});const noCultivateDetails=tempDiv.querySelector('.no-cultivate-details');if(noCultivateDetails){noCultivateDetails.innerHTML=`<i data-translate="No matching cultivate details found">${getTranslatedText("No matching cultivate details found")}</i>`;}
const noFarmDetails=tempDiv.querySelector('.no-farm-details');if(noFarmDetails){noFarmDetails.innerHTML=`<i data-translate="Farm details not found">${getTranslatedText("Farm details not found")}</i>`;}
return tempDiv.innerHTML;}
function updateDynamicContent(){const showAllSpan=document.querySelector('.needs-attention span[data-translate="Show all"]');if(showAllSpan){showAllSpan.textContent=translations[currentLang]["Show all"];}
const alertSpan=document.querySelector('.needs-attention .attention-text');if(alertSpan){alertSpan.textContent=translations[currentLang]["Alert"];}
const tooltipSpan=document.querySelector('.needs-attention .tooltip-bottom');if(tooltipSpan){tooltipSpan.textContent=translations[currentLang]["Show farms needing attention"];}}
function updateChartsLanguage(){const newMoistureLabel=currentLang==='vi'?"Äá»™ áº©m (%)":"Moisture (%)";const newTemperatureLabel=currentLang==='vi'?"Nhiá»‡t Ä‘á»™ (Â°C)":"Temperature (Â°C)";if(typeof moistChart!=='undefined'&&moistChart!==null){moistChart.data.datasets[0].label=newMoistureLabel;moistChart.update();}
if(typeof tempChart!=='undefined'&&tempChart!==null){tempChart.data.datasets[0].label=newTemperatureLabel;tempChart.update();}
if(typeof treeTypeChart!=='undefined'&&treeTypeChart!==null){updateChartLanguage();}}
function getTranslatedLabels(){return[translations[currentLang]["Coffee"],translations[currentLang]["Durian"],translations[currentLang]["Pepper"],translations[currentLang]["Tea"]];}
function updateChartLanguage(){if(treeTypeChart){const newLabels=getTranslatedLabels();treeTypeChart.data.labels=newLabels;treeTypeChart.options.plugins.legend.labels.generateLabels=function(chart){return newLabels.map((label,i)=>({text:label,fillStyle:chart.data.datasets[0].backgroundColor[i],hidden:false,index:i}));};treeTypeChart.update();}}
function updateRecommendationTooltips(){console.log("NPK status element:",document.querySelector('.nutrient-status'));const tooltipContainers=['npk-recommendation-container','moisture-recommendation-container','ph-recommendation-container','temp-recommendation-container'];tooltipContainers.forEach(containerId=>{const container=document.getElementById(containerId);if(container){const tooltipContent=container.querySelector('p');if(tooltipContent){const status=getStatusFromContainer(containerId);console.log(`Status for ${containerId}:`,status);console.log(`Status element:`,document.querySelector(`.${containerId.replace('-recommendation-container','')}-status`));const recommendations=getRecommendationFunction(containerId)(status);console.log(`Recommendations for ${containerId}:`,recommendations);console.log(`Current language:`,currentLang);tooltipContent.innerHTML=recommendations[currentLang];}else{console.log(`Tooltip content not found for ${containerId}`);}}else{console.log(`Container not found:${containerId}`);}});}
function getStatusFromContainer(containerId){let statusClass=containerId.replace('-recommendation-container','-status');if(containerId==='npk-recommendation-container'){statusClass='nutrient-status';}
const statusElement=document.querySelector(`.${statusClass}`);console.log(`Searching for:.${statusClass}`);console.log("Status element found:",statusElement);if(statusElement){const statusSpan=statusElement.querySelector('span[data-translate]');console.log("Status span found:",statusSpan);if(statusSpan){return statusSpan.getAttribute('data-translate');}
return statusElement.textContent.trim();}
return'No data';}
function getRecommendationFunction(containerId){switch(containerId){case'npk-recommendation-container':return getNutrientRecommendation;case'moisture-recommendation-container':return getMoistureRecommendation;case'ph-recommendation-container':return getPHRecommendation;case'temp-recommendation-container':return getTempRecommendation;default:return()=>({en:"",vi:""});}}
function updateRecommendationHeaders(){const headers=document.querySelectorAll('.recommendation-header');headers.forEach(header=>{header.textContent=currentLang==='en'?'Recommendations:':'Khuyáº¿n nghá»‹:';});}
function updateNutrientStatus(){const nutrientStatusElement=document.querySelector('.nutrient-status span[data-translate]');if(nutrientStatusElement){const key=nutrientStatusElement.getAttribute('data-translate');nutrientStatusElement.textContent=getTranslatedText(key);}}
function updateMoistureStatus(){const moistureStatusElement=document.querySelector('.moisture-status span[data-translate]');if(moistureStatusElement){const key=moistureStatusElement.getAttribute('data-translate');moistureStatusElement.textContent=getTranslatedText(key);}}
function updatePHStatus(){const phStatusElement=document.querySelector('.ph-status span[data-translate]');if(phStatusElement){const key=phStatusElement.getAttribute('data-translate');phStatusElement.textContent=getTranslatedText(key);}}
function updateTempStatus(){const tempStatusElement=document.querySelector('.temp-status span[data-translate]');if(tempStatusElement){const key=tempStatusElement.getAttribute('data-translate');tempStatusElement.textContent=getTranslatedText(key);}}
function updateRainViewerTexts(){console.log("Updating Rain Viewer texts. Current language:",currentLang);if(rainviewer&&rainviewer._container){const elements={playStopButton:rainviewer._container.querySelector('.leaflet-control-rainviewer-startstop'),positionLabel:rainviewer._container.querySelector('.leaflet-control-rainviewer-label[for="rainviewer-positionslider"]'),opacityLabel:rainviewer._container.querySelector('.leaflet-control-rainviewer-label[for="rainviewer-opacityslider"]'),realTimeText:rainviewer._container.querySelector('.real-time-text'),timestampElement:rainviewer._container.querySelector('#timestamp')};if(elements.playStopButton){elements.playStopButton.value=getTranslatedText("Start/Stop");}
if(elements.positionLabel){elements.positionLabel.textContent=getTranslatedText("Adjust time:");}
if(elements.opacityLabel){elements.opacityLabel.textContent=getTranslatedText("Adjust layer opacity:");}
if(elements.realTimeText){elements.realTimeText.textContent=getTranslatedText("Real-time Radar Data");}
if(elements.timestampElement){const currentText=elements.timestampElement.textContent;const updatedText=currentText.replace(/Forecast/g,getTranslatedText("Forecast")).replace(/Past/g,getTranslatedText("Past")).replace(/\bmin\b/g,getTranslatedText("min")).replace(/ago/g,getTranslatedText("min ago").replace('min ',''));elements.timestampElement.textContent=updatedText;}}}